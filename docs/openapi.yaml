openapi: 3.0.3
info:
  title: KeyVault Lite API
  description: A lightweight, self-hosted secret manager API inspired by AWS Secrets Manager
  version: 1.0.0
  contact:
    name: KeyVault Lite Support

servers:
  - url: http://localhost:5000
    description: Development server
  - url: https://api.example.com
    description: Production server

tags:
  - name: Health
    description: Health check endpoints
  - name: Secrets
    description: Secret management endpoints

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Check if the API is running
      operationId: healthCheck
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  timestamp:
                    type: string
                    format: date-time

  /api/secrets:
    get:
      tags:
        - Secrets
      summary: List all secrets
      description: Retrieve all secrets (metadata only, not values)
      operationId: listSecrets
      parameters:
        - name: tag
          in: query
          description: Filter by tag
          required: false
          schema:
            type: string
        - name: search
          in: query
          description: Search in name and description
          required: false
          schema:
            type: string
      responses:
        '200':
          description: List of secrets
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListSecretsResponse'

    post:
      tags:
        - Secrets
      summary: Create a new secret
      description: Create a new secret with encrypted storage
      operationId: createSecret
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSecretRequest'
      responses:
        '201':
          description: Secret created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Secret already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/secrets/{name}:
    get:
      tags:
        - Secrets
      summary: Get secret by name
      description: Retrieve a specific secret by name (includes decrypted value)
      operationId: getSecret
      parameters:
        - name: name
          in: path
          required: true
          description: Secret name
          schema:
            type: string
      responses:
        '200':
          description: Secret found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretResponse'
        '404':
          description: Secret not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Secrets
      summary: Update secret
      description: Update an existing secret
      operationId: updateSecret
      parameters:
        - name: name
          in: path
          required: true
          description: Secret name
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSecretRequest'
      responses:
        '200':
          description: Secret updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretResponse'
        '404':
          description: Secret not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Secrets
      summary: Delete secret
      description: Delete a secret permanently
      operationId: deleteSecret
      parameters:
        - name: name
          in: path
          required: true
          description: Secret name
          schema:
            type: string
      responses:
        '200':
          description: Secret deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Secret deleted successfully
        '404':
          description: Secret not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    SecretResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        value:
          type: string
          description: Only included when retrieving a single secret
        description:
          type: string
          nullable: true
        tags:
          type: array
          items:
            type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        version:
          type: integer

    SecretSummaryResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
          nullable: true
        tags:
          type: array
          items:
            type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        version:
          type: integer

    ListSecretsResponse:
      type: object
      properties:
        secrets:
          type: array
          items:
            $ref: '#/components/schemas/SecretSummaryResponse'
        total:
          type: integer

    CreateSecretRequest:
      type: object
      required:
        - name
        - value
      properties:
        name:
          type: string
          maxLength: 255
          pattern: '^[a-zA-Z0-9_-]+$'
          description: Unique secret name (alphanumeric, hyphens, underscores only)
        value:
          type: string
          maxLength: 10000
          description: Secret value to encrypt
        description:
          type: string
          maxLength: 1000
          nullable: true
        tags:
          type: array
          items:
            type: string
          nullable: true

    UpdateSecretRequest:
      type: object
      properties:
        value:
          type: string
          maxLength: 10000
          nullable: true
        description:
          type: string
          maxLength: 1000
          nullable: true
        tags:
          type: array
          items:
            type: string
          nullable: true

    ErrorResponse:
      type: object
      properties:
        error:
          $ref: '#/components/schemas/ErrorDetail'

    ErrorDetail:
      type: object
      properties:
        code:
          type: string
          example: SECRET_NOT_FOUND
        message:
          type: string
          example: Secret with name 'api-key' not found
        details:
          type: object
          additionalProperties: true
          nullable: true

